# Technology Stack: Talos Linux SBC Overlay for NanoPi M6

**Project:** Talos Linux NanoPi M6 Image
**Researched:** 2026-02-02
**Overall Confidence:** HIGH (verified with official sources and active community projects)

## Executive Summary

Building a custom Talos Linux SBC overlay for the NanoPi M6 (RK3588S) requires a specific stack centered around the Siderolabs build ecosystem (`bldr`, `kres`, `imager`) combined with community-maintained RK3588 kernel and U-Boot sources. The milas/talos-sbc-rk3588 project provides a proven foundation using Collabora's mainline-focused forks, which is the recommended approach over the official siderolabs/sbc-rockchip (which uses different kernel sources and doesn't support NanoPi boards).

## Recommended Stack

### Build System Core

| Technology | Version | Purpose | Why | Confidence |
|------------|---------|---------|-----|------------|
| **bldr** | v0.3.0+ | Container-based package builder | Siderolabs standard for all overlay/extension builds. Uses BuildKit for reproducible builds. Required for Pkgfile processing. | HIGH |
| **kres** | latest | Makefile/build config generator | Auto-generates Makefile, Dockerfile, CI configs from `.kres.yaml`. Used by all siderolabs overlay projects. Eliminates manual build scaffolding. | HIGH |
| **Talos imager** | v1.10.x+ | Boot asset generator | Combines overlay, kernel, and Talos base into bootable images. Critical for producing final SD/eMMC images. | HIGH |
| **Docker/Buildx** | 24.0+ | Build runtime | Required by bldr and imager. ARM64 cross-compilation requires buildx with QEMU or native ARM64 runner. | HIGH |

### Kernel & Bootloader Sources

| Technology | Version/Branch | Purpose | Why | Confidence |
|------------|----------------|---------|-----|------------|
| **Linux Kernel (Collabora fork)** | 6.9.x mainline branch | RK3588 kernel with mainline patches | Collabora maintains the reference implementation for RK3588 mainline. milas/talos-sbc-rk3588 uses this. Includes most hardware enablement while tracking mainline closely. | HIGH |
| **Armbian linux-rockchip** | `rk-6.1-rkr3` or `rk-6.1-rkr5.1` | Device tree source for NanoPi M6 | **Only verified source** for NanoPi M6 device tree (`rk3588s-nanopi-m6.dts`). Merged October 2024 by @efectn. Required for hardware initialization. | HIGH |
| **U-Boot (Collabora fork)** | v2024.01+ | Bootloader | Collabora's mainline-focused U-Boot with RK3588 support. USB-PD handling merged in 2025.01 release. Used by milas project. | HIGH |
| **ARM Trusted Firmware** | v2.12+ | Secure boot firmware (BL31) | Open-source TF-A with RK3588 support merged. Required for boot chain. | MEDIUM |
| **Rockchip DDR Blob** | v1.19+ | DDR memory training | **Closed-source binary** - unavoidable. `rk3588_ddr_lp4_2112MHz_lp5_2400MHz_v1.19.bin` from rkbin repo. | HIGH |

### Base Project

| Technology | Version | Purpose | Why | Confidence |
|------------|---------|---------|-----|------------|
| **milas/talos-sbc-rk3588** | v1.7.4-rk3588.alpha.5+ | Project foundation | Working RK3588 overlay with Collabora kernel/U-Boot integration. Currently supports Rock 5A/5B. Structure matches Siderolabs overlay conventions. Fork and extend for NanoPi M6. | HIGH |

### Talos Linux Version Target

| Technology | Version | Purpose | Why | Confidence |
|------------|---------|---------|-----|------------|
| **Talos Linux** | v1.10.x (stable: v1.10.9) | Base OS | Recommended for SBC overlays. Major improvements: systemd-boot for UEFI, unified /usr filesystem. Kernel 6.12.x baseline. v1.10+ required for modern overlay support. | HIGH |

**Why not v1.11 or v1.12?**
- v1.11 (kernel 6.12.x) and v1.12 (kernel 6.18.x) are newer but the overlay ecosystem targets v1.10 LTS
- milas/talos-sbc-rk3588 tracks v1.7.x, upgrade to v1.10.x is reasonable
- v1.12 brings breaking changes (unified /usr) that require overlay updates

### Development Tools

| Technology | Version | Purpose | Why | Confidence |
|------------|---------|---------|-----|------------|
| **Go** | 1.24.x | Installer binary | Overlay installers are Go binaries using siderolabs/talos machinery/overlay/adapter package. | HIGH |
| **Make** | 4.x+ | Build orchestration | Primary build interface via Makefile (generated by kres). | HIGH |
| **cosign** | 2.x+ | Image signing/verification | All siderolabs overlays are signed. Required for verification if publishing. | MEDIUM |

### Container Registry

| Technology | Version | Purpose | Why | Confidence |
|------------|---------|---------|-----|------------|
| **GitHub Container Registry** | N/A | Image hosting | Standard for overlay images. `ghcr.io/[username]/[overlay-name]`. | HIGH |

## Overlay Structure (Required Files)

```
nanopi-m6/
├── .kres.yaml              # Build configuration for kres
├── Pkgfile                 # bldr package definitions (kernel, u-boot, firmware)
├── Makefile                # Generated by kres
├── go.work                 # Go workspace
├── artifacts/
│   └── arm64/
│       ├── dtb/            # Device tree blobs (compiled from DTS)
│       ├── firmware/       # RK3588 firmware files (bl31, ddr blob)
│       └── u-boot/         # U-Boot binary (idbloader.img, u-boot.itb)
├── installers/
│   └── nanopi-m6/
│       ├── pkg.yaml        # Installer package definition
│       └── src/
│           └── main.go     # Installer binary (implements overlay.Installer)
├── profiles/
│   └── nanopi-m6.yaml      # Disk image profile (size, bootloader, format)
└── internal/
    └── base/               # Shared utilities
```

## Alternatives Considered

| Category | Recommended | Alternative | Why Not Alternative |
|----------|-------------|-------------|---------------------|
| Base project | milas/talos-sbc-rk3588 | siderolabs/sbc-rockchip | sbc-rockchip doesn't support NanoPi boards. Uses different kernel sources. Would require more extensive modifications. |
| Base project | milas/talos-sbc-rk3588 | siderolabs/sbc-template | Template is empty starting point. milas project has working RK3588 infrastructure. |
| Kernel | Collabora mainline fork | Armbian linux-rockchip full | Armbian kernel is vendor-heavy (BSP). Collabora tracks mainline more closely, better for Talos. |
| Kernel | Collabora mainline fork | FriendlyElec vendor kernel | Vendor kernel (6.1.y) is too old, missing mainline patches, not designed for Talos. |
| Kernel | Collabora 6.9.x | Upstream mainline 6.18.x | Mainline 6.18 still lacks full RK3588 support (HDMI issues before 6.15). Collabora integration branch is safer. |
| U-Boot | Collabora fork | Rockchip vendor U-Boot | Vendor U-Boot is old (2017.09), doesn't support modern boot flows. Collabora is mainline-focused. |
| U-Boot | Collabora fork | EDK2-RK3588 UEFI | UEFI is alternative boot approach but not compatible with Talos SBC overlay expectations. |
| Talos version | v1.10.x | v1.7.x (milas current) | v1.7.x is old. v1.10.x has better ARM64 support, systemd-boot, and is still maintained. |
| Talos version | v1.10.x | v1.12.x (latest) | v1.12.x has unified /usr breaking changes. Stick with v1.10.x for stability. |

## What NOT to Use

| Technology | Why Avoid |
|------------|-----------|
| **FriendlyElec vendor kernel** | Based on old Linux 6.1.y, heavily patched vendor BSP, incompatible with Talos build system |
| **Rockchip vendor U-Boot** | Ancient (2017.09), missing modern boot support, doesn't integrate with Talos overlay system |
| **siderolabs/sbc-rockchip** for NanoPi | No NanoPi support, uses different kernel source strategy, would require forking anyway |
| **Armbian build system** | Designed for full distro builds, not Talos overlays. Extract device tree only. |
| **UEFI (EDK2-RK3588)** | Different boot paradigm. Talos SBC overlays expect U-Boot flow. |
| **Mainline kernel without Collabora patches** | Missing RK3588 enablement. HDMI broken before 6.15, many drivers not merged. |
| **cgroupsv1** | Talos 1.10+ removed cgroupsv1 support for non-container mode |

## Build Process Overview

### Phase 1: Project Setup
```bash
# Fork milas/talos-sbc-rk3588
git clone https://github.com/milas/talos-sbc-rk3588 nanopi-m6
cd nanopi-m6

# Regenerate build configs
make rekres
```

### Phase 2: Add NanoPi M6 Support
1. Extract device tree from Armbian `rk-6.1-rkr3` branch
2. Create/adapt U-Boot defconfig (based on nanopi-r6c-rk3588s_defconfig)
3. Add installer in `installers/nanopi-m6/`
4. Add profile in `profiles/nanopi-m6.yaml`

### Phase 3: Build Overlay
```bash
# Build all packages
make PUSH=true REGISTRY=ghcr.io USERNAME=[your-username]

# Or build locally without pushing
make
```

### Phase 4: Generate Talos Image
```bash
docker run --rm -t -v ./_out:/out --privileged \
  ghcr.io/siderolabs/imager:v1.10.9 \
  metal --arch arm64 \
  --overlay-name=nanopi-m6 \
  --overlay-image=ghcr.io/[username]/nanopi-m6:latest
```

## Hardware Requirements for Development

| Requirement | Specification | Notes |
|-------------|---------------|-------|
| **Build Machine** | ARM64 native or x86_64 with QEMU/buildx | ARM64 native 3-5x faster. milas uses Hetzner ARM64 VM. |
| **Storage** | 50GB+ free | Kernel builds are large |
| **RAM** | 16GB+ recommended | Kernel compilation is memory-intensive |
| **Test Hardware** | NanoPi M6 with eMMC or microSD | Required for final validation |

## Firmware/Blob Sources

| Component | Source Repository | File Path | Notes |
|-----------|-------------------|-----------|-------|
| BL31 (ARM Trusted Firmware) | rockchip/rkbin or TF-A mainline | `rk3588/bl31.elf` | Open source as of TF-A v2.12 |
| DDR Blob | rockchip/rkbin | `rk3588_ddr_lp4_2112MHz_lp5_2400MHz_v1.19.bin` | Closed source, unavoidable |
| TPL | Built from U-Boot | Generated during build | Part of idbloader.img |

## Dependency Version Matrix

| Component | milas/talos-sbc-rk3588 v1.7.4 | Target for NanoPi M6 |
|-----------|-------------------------------|---------------------|
| Talos Linux | v1.7.4 | v1.10.9 |
| Linux Kernel | 6.9.0 (Collabora) | 6.9.x or 6.12.x (Collabora) |
| U-Boot | v2024.01 (Collabora) | v2024.01+ or v2025.01 |
| bldr | v0.3.0 | v0.3.0 |
| Go | 1.22.x | 1.24.x |

## Sources

### Official Documentation (HIGH confidence)
- [Talos Linux Overlays Documentation](https://docs.siderolabs.com/talos/v1.10/build-and-extend-talos/custom-images-and-development/overlays)
- [Talos v1.10.0 Release Notes](https://github.com/siderolabs/talos/releases/tag/v1.10.0)
- [siderolabs/overlays Repository](https://github.com/siderolabs/overlays)
- [siderolabs/bldr Repository](https://github.com/siderolabs/bldr)
- [siderolabs/kres Repository](https://github.com/siderolabs/kres)
- [siderolabs/sbc-template Repository](https://github.com/siderolabs/sbc-template)
- [siderolabs/pkgs Repository](https://github.com/siderolabs/pkgs)

### Community Projects (HIGH confidence - actively maintained)
- [milas/talos-sbc-rk3588 Repository](https://github.com/milas/talos-sbc-rk3588)
- [milas/talos-sbc-rk3588 Releases](https://github.com/milas/talos-sbc-rk3588/releases)

### Hardware Enablement (HIGH confidence)
- [Collabora RK3588 Upstream Status](https://www.collabora.com/news-and-blog/news-and-events/rockchip-rk3588-upstream-support-progress-future-plans.html)
- [Collabora RK3588 GitLab](https://gitlab.collabora.com/hardware-enablement/rockchip-3588/notes-for-rockchip-3588/)
- [Armbian linux-rockchip Repository](https://github.com/armbian/linux-rockchip)

### Device-Specific (MEDIUM confidence - community maintained)
- [FriendlyELEC NanoPi M6 Wiki](https://wiki.friendlyelec.com/wiki/index.php/NanoPi_M6)
- [Armbian NanoPi M6 Page](https://www.armbian.com/nanopi-m6/)

### Background Research
- [CNX Software: RK3588 Mainline Status 2025](https://www.cnx-software.com/2024/12/21/rockchip-rk3588-mainline-linux-support-current-status-and-future-work-for-2025/)
- [siderolabs/sbc-rockchip Repository](https://github.com/siderolabs/sbc-rockchip) (reference only, not recommended as base)
