---
phase: 01-environment-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - README.md
autonomous: true

must_haves:
  truths:
    - "Repository is forked from milas/talos-sbc-rk3588"
    - "Repository cloned locally and pushes to user's GitHub"
    - "Project structure matches expected layout for SBC overlay"
  artifacts:
    - path: ".git/config"
      provides: "Git remote configuration"
      contains: "github.com"
    - path: ".kres.yaml"
      provides: "kres build configuration"
    - path: "Pkgfile"
      provides: "bldr package definitions"
  key_links:
    - from: "local repo"
      to: "GitHub origin"
      via: "git remote"
      pattern: "origin.*github.com"
---

<objective>
Fork the milas/talos-sbc-rk3588 repository and establish the NanoPi M6 project baseline.

Purpose: Creates the foundation for all subsequent build and development work. Without a properly forked repository with working git remotes, no code can be developed or CI configured.

Output: A cloned repository with origin pointing to user's GitHub fork, ready for local development.
</objective>

<execution_context>
@/Users/johnsonhuynh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johnsonhuynh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-environment-setup/01-CONTEXT.md
@.planning/phases/01-environment-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fork and clone repository</name>
  <files>.git/config</files>
  <action>
Use the gh CLI to fork milas/talos-sbc-rk3588 to the user's GitHub account, then set up the local repository:

1. Fork the upstream repository:
   ```bash
   gh repo fork milas/talos-sbc-rk3588 --clone=false --fork-name=nanopi-m6
   ```

2. Since we're in an existing repo with .planning/, we need to pull the forked content:
   ```bash
   git remote add upstream https://github.com/milas/talos-sbc-rk3588.git
   git fetch upstream
   git merge upstream/main --allow-unrelated-histories -m "Merge upstream talos-sbc-rk3588 base"
   ```

3. Verify remotes are configured correctly:
   ```bash
   git remote -v
   ```

Note: The existing .planning/ directory will be preserved. The merge brings in the SBC overlay codebase alongside our planning docs.
  </action>
  <verify>
- `git remote -v` shows origin (user's fork) and upstream (milas/talos-sbc-rk3588)
- `ls` shows expected project files: .kres.yaml, Pkgfile, artifacts/, installers/
- `git log --oneline -5` shows merge commit
  </verify>
  <done>Repository contains merged upstream codebase with both remotes configured</done>
</task>

<task type="auto">
  <name>Task 2: Configure project for NanoPi M6</name>
  <files>.gitignore, README.md</files>
  <action>
Update project files to reflect NanoPi M6 focus:

1. Update .gitignore with recommended patterns from research:
   ```gitignore
   # Build outputs
   _out/
   *.raw
   *.raw.xz
   *.tar

   # Generated files
   .dockerignore
   .drone.yaml
   .golangci.yml

   # IDE
   .idea/
   .vscode/
   *.swp

   # OS
   .DS_Store
   Thumbs.db
   ```

2. Update README.md with project-specific content:
   - Title: "Talos Linux NanoPi M6 Overlay"
   - Brief description referencing NanoPi M6 / RK3588S
   - Link to planning docs for detailed context
   - Basic build instructions (will expand in later plans)

3. Commit changes:
   ```bash
   git add .gitignore README.md
   git commit -m "chore: configure project for NanoPi M6"
   ```
  </action>
  <verify>
- `cat .gitignore` shows _out/ and *.raw patterns
- `cat README.md` mentions NanoPi M6
- `git status` shows clean working tree
  </verify>
  <done>Project configured with NanoPi M6-specific gitignore and README</done>
</task>

<task type="auto">
  <name>Task 3: Push to GitHub</name>
  <files>None (git operation)</files>
  <action>
Push the configured repository to GitHub:

1. Push all changes including planning docs:
   ```bash
   git push origin main
   ```

2. Verify push succeeded by checking GitHub (via gh CLI):
   ```bash
   gh repo view --web
   ```
   Or verify via API:
   ```bash
   gh api repos/{owner}/{repo} --jq '.pushed_at'
   ```

Note: If the fork doesn't exist yet (fork command failed earlier), create it:
```bash
gh repo create nanopi-m6 --public --source=. --push
```
  </action>
  <verify>
- `gh repo view` shows the repository exists on GitHub
- `git log origin/main --oneline -3` matches local commits
  </verify>
  <done>Repository pushed to GitHub with all initial commits</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `git remote -v` shows origin pointing to user's GitHub nanopi-m6 repo
2. `ls -la` shows .kres.yaml, Pkgfile, artifacts/, installers/ directories
3. `git log --oneline -5` shows merge and configuration commits
4. `gh repo view` confirms repository accessible on GitHub
</verification>

<success_criteria>
- Repository forked from milas/talos-sbc-rk3588
- Local clone has origin (user's fork) and upstream (milas) remotes
- .gitignore configured for build outputs
- README.md reflects NanoPi M6 project
- All commits pushed to GitHub
</success_criteria>

<output>
After completion, create `.planning/phases/01-environment-setup/01-01-SUMMARY.md`
</output>
